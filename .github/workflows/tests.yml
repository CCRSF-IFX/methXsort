name: Run Tests

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  test:
    name: Test on Python 3.12
    runs-on: ubuntu-latest
        
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python 3.12
      uses: actions/setup-python@v5
      with:
        python-version: '3.12'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip setuptools wheel
        pip install -e .
        
    - name: Verify dependency versions
      run: |
        echo "Python version:"
        python --version
        echo ""
        echo "Installed packages:"
        pip list | grep -E "(pysam|xengsort)"
        echo ""
        echo "Verifying key dependencies..."
        python -c "import pysam; print(f'✓ pysam {pysam.__version__}')"
        python -c "import sys; print(f'✓ Python {sys.version}')"
        python -c "import xengsort; print(f'✓ xengsort available')"
        
    - name: Test package import
      run: |
        python -c "from methxsort import core"
        python -c "from methxsort.core import convert_fasta, convert_reads_c2t_r1_g2a_r2"
        python -c "from methxsort.core import run_bbsplit, build_bbsplit_index"
        python -c "from methxsort.core import stat_split, run_xengsort_classify"
        
    - name: Test CLI help
      run: |
        methXsort --help
        methXsort --version
        python -m methxsort --help
        
    - name: Test subcommand help
      run: |
        methXsort convert-ref --help
        methXsort convert-reads --help
        methXsort filter-fastq-by-bam --help
        methXsort bbsplit --help
        methXsort bbsplit-index --help
        methXsort stat-split --help
        methXsort xengsort-index --help
        methXsort xengsort-classify --help
        methXsort restore-fastq --help
        methXsort parse-xengsort-summary --help
        methXsort parse-xengsort-log-table --help
